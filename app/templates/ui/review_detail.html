{% extends "ui/base.html" %}
{% block title %}ë¦¬ë·° ìƒì„¸{% endblock %}

{% block content %}
<h2>ë¦¬ë·° #{{ rec.id }}</h2>

<p>
  <b>user_id</b>: {{ rec.user_id }}
  | <b>model</b>: {{ rec.model }}
  | <b>trigger</b>: {{ rec.trigger }}
  | <b>language</b>: {{ rec.language or 'N/A' }}
  | <b>status</b>: {{ rec.status }}
  | <b>created_at</b>: {{ rec.created_at }}
</p>

<h3>ìš”ì•½</h3>
{% if quality %}
  {# LLMì—ì„œ ì˜¨ review_summary ìš°ì„  ì‚¬ìš© #}
  <p>{{ quality.review_summary }}</p>
{% else %}
  {# LLM ì •ë³´ ì—†ìœ¼ë©´ DBì— ì €ì¥ëœ summary ì‚¬ìš© #}
  <p>{{ rec.summary or 'ìš”ì•½ ì—†ìŒ' }}</p>
{% endif %}

<h3>ì ìˆ˜</h3>

{% if quality %}
  {# ğŸ”¥ LLM JSON â†’ LLMQualityResponse ê¸°ì¤€ìœ¼ë¡œ ì¶œë ¥ #}
  <ul>
    <li>quality_score: {{ quality.quality_score }}</li>
    <li>bug: {{ quality.scores_by_category.bug }}</li>
    <li>performance: {{ quality.scores_by_category.performance }}</li>
    <li>maintainability: {{ quality.scores_by_category.maintainability }}</li>
    <li>style: {{ quality.scores_by_category.style }}</li>
    <li>docs: {{ quality.scores_by_category.docs }}</li>
    <li>dependency: {{ quality.scores_by_category.dependency }}</li>
    <li>security: {{ quality.scores_by_category.security }}</li>
    <li>testing: {{ quality.scores_by_category.testing }}</li>
  </ul>
{% else %}
  {# LLMQualityResponse ëª» ë§Œë“¤ì—ˆì„ ë•Œ ê¸°ì¡´ rec í•„ë“œ fallback #}
  <ul>
    <li>quality_score: {{ rec.quality_score }}</li>
    <li>bug: {{ rec.score_bug }}</li>
    <li>performance: {{ rec.score_performance }}</li>
    <li>maintainability: {{ rec.score_maintainability }}</li>
    <li>style: {{ rec.score_style }}</li>
    <li>docs: {{ rec.score_docs }}</li>
    <li>dependency: {{ rec.score_dependency }}</li>
    <li>security: {{ rec.score_security }}</li>
    <li>testing: {{ rec.score_testing }}</li>
  </ul>
{% endif %}

<h3>ì¹´í…Œê³ ë¦¬ë³„ ì½”ë©˜íŠ¸</h3>
<table>
  <thead>
    <tr>
      <th>category</th>
      <th>score</th>
      <th>comment</th>
    </tr>
  </thead>
  <tbody>
    {% if category_rows %}
      {# ğŸ”¥ ui.pyì—ì„œ build_category_rows ë¡œ ë§Œë“  8ì¤„ #}
      {% for row in category_rows %}
        <tr>
          <td>{{ row.category }}</td>
          <td>{{ row.score }}</td>
          <td>{{ row.comment }}</td>
        </tr>
      {% endfor %}
    {% else %}
      {# fallback: ê¸°ì¡´ rec.* ì½”ë©˜íŠ¸ ì‚¬ìš© #}
      <tr>
        <td>bug</td>
        <td>{{ rec.score_bug }}</td>
        <td>{{ rec.comment_bug or '-' }}</td>
      </tr>
      <tr>
        <td>performance</td>
        <td>{{ rec.score_performance }}</td>
        <td>{{ rec.comment_performance or '-' }}</td>
      </tr>
      <tr>
        <td>maintainability</td>
        <td>{{ rec.score_maintainability }}</td>
        <td>{{ rec.comment_maintainability or '-' }}</td>
      </tr>
      <tr>
        <td>style</td>
        <td>{{ rec.score_style }}</td>
        <td>{{ rec.comment_style or '-' }}</td>
      </tr>
      <tr>
        <td>docs</td>
        <td>{{ rec.score_docs }}</td>
        <td>{{ rec.comment_docs or '-' }}</td>
      </tr>
      <tr>
        <td>dependency</td>
        <td>{{ rec.score_dependency }}</td>
        <td>{{ rec.comment_dependency or '-' }}</td>
      </tr>
      <tr>
        <td>security</td>
        <td>{{ rec.score_security }}</td>
        <td>{{ rec.comment_security or '-' }}</td>
      </tr>
      <tr>
        <td>testing</td>
        <td>{{ rec.score_testing }}</td>
        <td>{{ rec.comment_testing or '-' }}</td>
      </tr>
    {% endif %}
  </tbody>
</table>

<p style="margin-top:16px;">
  <a href="/ui/review/{{ rec.id }}/logs">ì•¡ì…˜ ë¡œê·¸ ë³´ê¸°</a>
</p>
{% endblock %}
